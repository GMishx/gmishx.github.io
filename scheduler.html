<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>FOSSology: FOSSology Scheduler</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fossology-logo.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FOSSology
   &#160;<span id="projectnumber">3.2.0rc1</span>
   </div>
   <div id="projectbrief">Open Source License Compliance by Open Source Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('scheduler.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">FOSSology Scheduler </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#schedulerabout">About scheduler</a></li>
<li class="level1"><a href="#schedulerterminology">Terminology</a><ul><li class="level2"><a href="#jobstreamterm">Job stream</a></li>
<li class="level2"><a href="#jobterm">Job</a></li>
<li class="level2"><a href="#agentterm">Agent</a></li>
</ul>
</li>
<li class="level1"><a href="#schedulerarchitecture">Scheduler Architecture</a></li>
<li class="level1"><a href="#scheduleractions">Communicating with scheduler</a></li>
<li class="level1"><a href="#schedulersource">Agent source</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="schedulerabout"></a>
About scheduler</h1>
<p>The FOSSology job scheduler is a daemon that periodically checks the job queue and spawns agents to run scans. Multiple jobs can be run simultaneously as defined in fossology.conf. </p>
<h1><a class="anchor" id="schedulerterminology"></a>
Terminology</h1>
<h2><a class="anchor" id="jobstreamterm"></a>
Job stream</h2>
<p>A list of all the job steps queued at the same time for an upload. For example, all the job steps (programs) necessary to get a particular upload from unpack through all of its scans. </p>
<h2><a class="anchor" id="jobterm"></a>
Job</h2>
<p>A specific step in the process of working on an upload. Each job would be associated with a different type of agent. For example if a person uploaded a .tar file and wanted license and copyright analysis run on the file, there would be a job for the unpack step, a job for the license step and a job for the copyright step. </p>
<h2><a class="anchor" id="agentterm"></a>
Agent</h2>
<p>The actual process that the scheduler will spawn and be communicating with. An instance of the copyright scanner would be an example of an agent. A job is a scheduler construct used to run an agent process. </p>
<h1><a class="anchor" id="schedulerarchitecture"></a>
Scheduler Architecture</h1>
<p>Scheduler use a classic client server communication style for both the agent communication and the UI communication. Every time a new communication channel is needed, the scheduler will create a new thread to manage the communications with that channel. This makes the communication logic much simpler.</p>
<p>If the communication thread receives anything that would involve changing a data structure internal to the scheduler, it passes the information off to the main thread instead of changing it personally. The communication threads send information to the main thread using events. The communication thread will package the function and arguments and pass it to a concurrent queue that the main thread is waiting on.</p>
<p>When a new job stream is found in the job queue, the scheduler will create only the jobs for that job stream that have all the preconditions fulfilled. Once created the jobs will have agents allocated to them. Allocated agents belong to the job and will remain in the scheduler's data structures until the job is removed from the system. Jobs are responsible for cleaning up any agents allocated to them.</p>
<p>Within a job, when an agent is ready for data, it will inform the main thread that it is waiting. The main thread will then take a chunk of data from the job that the agent belongs to and allocate it to the agent. The communication thread will then be responsible for sending the data to the corresponding process. It is important to note that the communication threads are using blocking IO on the pipe from the corresponding process. As a result, any string that starts with "@" is reserved as a communication from the scheduler instead of the corresponding process. Writing anything that starts with "@" to stdout within an agent will result in undefined behavior.</p>
<p>Here are some other properties of the scheduler:</p><ul>
<li>Scheduler can take advantage of multiple processors on whatever machine it is running on.</li>
<li>Simplified code for communicating with agents since all IO would be blocking instead of non-blocking.</li>
<li>Master thread can not get swamped with communications between the agents and can concentrate on managing new jobs.</li>
<li>Uses GLib</li>
<li>Job queue is implemented in db tables:<ul>
<li><b>job</b> - the job stream</li>
<li><b>jobqueue</b> - individual jobs</li>
<li><b>jobdepends</b> - job dependencies (for example, you can't run buckets until the license scan is done)</li>
</ul>
</li>
</ul>
<p><a href="https://github.com/fossology/fossology/wiki/Job-Scheduler">More info on scheduler</a> </p>
<h1><a class="anchor" id="scheduleractions"></a>
Communicating with scheduler</h1>
<p>You can send commands to a running scheduler. The scheduler listens on the port specified in fossology.conf. After a command is sent, the scheduler will respond with "received". You can send the following commands:</p>
<table class="doxtable">
<tr>
<th align="right">Command </th><th align="left">Definition  </th></tr>
<tr>
<td align="right">close </td><td align="left">Close the connection to the scheduler. </td></tr>
<tr>
<td align="right">stop </td><td align="left">Scheduler will gracefully shutdown after the currently running jobs have finished. </td></tr>
<tr>
<td align="right">pause &lt;job_id&gt; </td><td align="left">The job id (job_pk) will pause. All agents associated with the job will be put to sleep. </td></tr>
<tr>
<td align="right">agents </td><td align="left">Respond with a space separated list of agents configured to run. </td></tr>
<tr>
<td align="right">reload </td><td align="left">Reload the configuration information for the agents and hosts. </td></tr>
<tr>
<td align="right">status </td><td align="left">Respond on the same socket with all of the status information. </td></tr>
<tr>
<td align="right">status &lt;job_id&gt; </td><td align="left">Respond with a detailed status for the specific job. </td></tr>
<tr>
<td align="right">restart &lt;job_id&gt; </td><td align="left">Restart the job specified. </td></tr>
<tr>
<td align="right">verbose </td><td align="left">The verbosity level for the scheduler will be changed to match level. </td></tr>
<tr>
<td align="right">verbose &lt;job_id&gt; </td><td align="left">The verbosity level for all of the agents owned by the specified job will be changed to level. </td></tr>
<tr>
<td align="right">priority </td><td align="left">Changes the priority of a particular job within the scheduler. </td></tr>
<tr>
<td align="right">database </td><td align="left">Check the database job queue for new jobs. </td></tr>
</table>
<h1><a class="anchor" id="schedulersource"></a>
Agent source</h1>
<ul>
<li><a class="el" href="dir_996c7118294fd09b8484818795181f68.html">src/scheduler/agent</a></li>
<li>Test agents <a class="el" href="dir_460d0ad11da64c463879322ecdea8b14.html">src/scheduler/agent_tests/agents</a></li>
<li>Functional test cases <a class="el" href="dir_1e1f931b0ff11fbb6deba4c5fb2fba82.html">src/scheduler/agent_tests/Functional</a></li>
<li>Unit test cases <a class="el" href="dir_986445b792c5fd60cd0b03bdce48c43f.html">src/scheduler/agent_tests/Unit</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="agentlist.html">Agents in FOSSology</a></li>
    <li class="footer">Generated on Mon Jun 29 2020 12:03:46 for FOSSology by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
