<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>FOSSology: src/ununpack/agent/traverse.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../fossology-logo.gif"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FOSSology
   &#160;<span id="projectnumber">3.2.0rc1</span>
   </div>
   <div id="projectbrief">Open Source License Compliance by Open Source Software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('dc/d51/traverse_8c.html','../../');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">traverse.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Traverse directories.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;ununpack.h&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/df2/externs_8h_source.html">externs.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for traverse.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../db/d63/traverse_8c__incl.png" border="0" usemap="#src_2ununpack_2agent_2traverse_8c" alt=""/></div>
<map name="src_2ununpack_2agent_2traverse_8c" id="src_2ununpack_2agent_2traverse_8c">
<area shape="rect" id="node2" href="../../d3/d3f/ununpack_8h_source.html" title="ununpack.h" alt="" coords="1729,95,1825,121"/>
<area shape="rect" id="node41" href="../../d2/df2/externs_8h.html" title="Stores all extern variables used by the agent. " alt="" coords="1849,95,1931,121"/>
<area shape="rect" id="node20" href="../../d8/d3b/libfossology_8h.html" title="The main FOSSology C library. " alt="" coords="946,244,1053,271"/>
<area shape="rect" id="node37" href="../../dc/d31/checksum_8h_source.html" title="checksum.h" alt="" coords="1339,169,1438,196"/>
<area shape="rect" id="node38" href="../../d0/d42/ununpack-ar_8h_source.html" title="ununpack&#45;ar.h" alt="" coords="2407,169,2520,196"/>
<area shape="rect" id="node39" href="../../d4/dbe/ununpack-disk_8h_source.html" title="ununpack&#45;disk.h" alt="" coords="2544,169,2671,196"/>
<area shape="rect" id="node40" href="../../dc/dd2/ununpack-iso_8h_source.html" title="ununpack&#45;iso.h" alt="" coords="2695,169,2813,196"/>
<area shape="rect" id="node21" href="../../dc/d81/libfossscheduler_8h_source.html" title="libfossscheduler.h" alt="" coords="532,319,667,345"/>
<area shape="rect" id="node22" href="../../dc/df8/fossconfig_8h.html" title="FOSSology library to read config file. " alt="" coords="1009,393,1107,420"/>
<area shape="rect" id="node28" href="../../d1/dd3/libfossrepo_8h_source.html" title="libfossrepo.h" alt="" coords="1440,319,1543,345"/>
<area shape="rect" id="node33" href="../../d2/d5f/libfossdb_8h_source.html" title="libfossdb.h" alt="" coords="843,319,934,345"/>
<area shape="rect" id="node34" href="../../d8/d2f/libfossagent_8h_source.html" title="libfossagent.h" alt="" coords="345,319,456,345"/>
<area shape="rect" id="node36" href="../../d5/da6/sqlCopy_8h_source.html" title="sqlCopy.h" alt="" coords="958,319,1041,345"/>
<area shape="rect" id="node24" href="../../d4/d4c/libfossdbmanager_8h_source.html" title="libfossdbmanager.h" alt="" coords="398,393,545,420"/>
</map>
</div>
</div>
<p><a href="../../dc/d51/traverse_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a4da0dd2880528cc3d606115c7a0b6a6f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d51/traverse_8c.html#a4da0dd2880528cc3d606115c7a0b6a6f">TraverseStart</a> (char *<a class="el" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>, char *Label, char *<a class="el" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>, int <a class="el" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a>)</td></tr>
<tr class="memdesc:a4da0dd2880528cc3d606115c7a0b6a6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find all files (assuming a directory) and process (unpack) all of them.  <a href="#a4da0dd2880528cc3d606115c7a0b6a6f">More...</a><br /></td></tr>
<tr class="separator:a4da0dd2880528cc3d606115c7a0b6a6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85f808829ada5223b092deca6de501c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d51/traverse_8c.html#a85f808829ada5223b092deca6de501c6">TraverseChild</a> (int Index, <a class="el" href="../../d8/db7/structContainerInfo.html">ContainerInfo</a> *CI, char *<a class="el" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>)</td></tr>
<tr class="memdesc:a85f808829ada5223b092deca6de501c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called by exec'd child to process.  <a href="#a85f808829ada5223b092deca6de501c6">More...</a><br /></td></tr>
<tr class="separator:a85f808829ada5223b092deca6de501c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a0ed04e29704b6829ae0f4533cf4ebb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d51/traverse_8c.html#a5a0ed04e29704b6829ae0f4533cf4ebb">CountFilename</a> (char *Pathname, char *Dirname)</td></tr>
<tr class="memdesc:a5a0ed04e29704b6829ae0f4533cf4ebb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count the number of times Dirname appears in Pathname This is used to limit recursion in test archives that infinitely recurse.  <a href="#a5a0ed04e29704b6829ae0f4533cf4ebb">More...</a><br /></td></tr>
<tr class="separator:a5a0ed04e29704b6829ae0f4533cf4ebb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee3452933f7c7785132164905f1ea486"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d51/traverse_8c.html#aee3452933f7c7785132164905f1ea486">Traverse</a> (char *<a class="el" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a8f91fce8713dd601ee00a5fcef69c9c7">Filename</a>, char *Basename, char *Label, char *<a class="el" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a81115b7f9bc83e19bd414c35eae6ac83">NewDir</a>, int <a class="el" href="../../d3/d69/ununpack_2agent__tests_2Unit_2run__tests_8c.html#a5fa2363035a6f16330f4adf196c08e2c">Recurse</a>, <a class="el" href="../../d3/dbf/structParentInfo.html">ParentInfo</a> *PI)</td></tr>
<tr class="memdesc:aee3452933f7c7785132164905f1ea486"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find all files, traverse all directories. This is a depth-first search, in inode order!  <a href="#aee3452933f7c7785132164905f1ea486">More...</a><br /></td></tr>
<tr class="separator:aee3452933f7c7785132164905f1ea486"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Traverse directories. </p>

<p>Definition in file <a class="el" href="../../dc/d51/traverse_8c_source.html">traverse.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a5a0ed04e29704b6829ae0f4533cf4ebb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int CountFilename </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Pathname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Dirname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Count the number of times Dirname appears in Pathname This is used to limit recursion in test archives that infinitely recurse. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Pathname</td><td>Pathname of file to process </td></tr>
    <tr><td class="paramname">Dirname</td><td>Directory name to search for </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>number of occurances of Dirname in Pathname </dd></dl>
<p>Full Dirname (includes forward and trailing slashes and null terminator) </p>

<p>Definition at line <a class="el" href="../../dc/d51/traverse_8c_source.html#l00245">245</a> of file <a class="el" href="../../dc/d51/traverse_8c_source.html">traverse.c</a>.</p>

</div>
</div>
<a class="anchor" id="aee3452933f7c7785132164905f1ea486"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Traverse </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Basename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>NewDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Recurse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/dbf/structParentInfo.html">ParentInfo</a> *&#160;</td>
          <td class="paramname"><em>PI</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find all files, traverse all directories. This is a depth-first search, in inode order! </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Filename</td><td>Pathname of file to process </td></tr>
    <tr><td class="paramname">Basename</td><td>Optional basename() of Filename </td></tr>
    <tr><td class="paramname">Label</td><td>is used for debugging. </td></tr>
    <tr><td class="paramname">NewDir</td><td>Optional, specifies an alternate directory to extract to. Default (NewDir==NULL) is to extract to the same directory as Filename. </td></tr>
    <tr><td class="paramname">Recurse</td><td>&gt;0 to recurse </td></tr>
    <tr><td class="paramname">PI</td><td><a class="el" href="../../d3/dbf/structParentInfo.html">ParentInfo</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if Filename was a container, 0 if not a container. (The return value is really only used by <a class="el" href="../../dc/d51/traverse_8c.html#a4da0dd2880528cc3d606115c7a0b6a6f" title="Find all files (assuming a directory) and process (unpack) all of them. ">TraverseStart()</a>.) </dd></dl>

<p>Definition at line <a class="el" href="../../dc/d51/traverse_8c_source.html#l00282">282</a> of file <a class="el" href="../../dc/d51/traverse_8c_source.html">traverse.c</a>.</p>

</div>
</div>
<a class="anchor" id="a85f808829ada5223b092deca6de501c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TraverseChild </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/db7/structContainerInfo.html">ContainerInfo</a> *&#160;</td>
          <td class="paramname"><em>CI</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>NewDir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called by exec'd child to process. </p>
<p>The child never leaves here! It calls EXIT! Exit is 0 on success, non-zero on failure. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Index</td><td>Child index into the queue table </td></tr>
    <tr><td class="paramname">CI</td><td>The <a class="el" href="../../d8/db7/structContainerInfo.html" title="Structure for storing information about a particular file. ">ContainerInfo</a> </td></tr>
    <tr><td class="paramname">NewDir</td><td>Optional, specifies an alternate directory to extract to. </td></tr>
  </table>
  </dd>
</dl>
<p>If the file processed is one original uploaded file and it is an archive, also using repository, need to reset the file name in the archive, if do not reset, for the gz Z bz2 archives, the file name in the archive is sha1.md5.size file name, that is:</p>
<p>For example: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;argmatch.c.gz    ---&gt; CI-&gt;Source  ---&gt;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;657db64230b9d647362bfe0ebb82f7bd1d879400.a0f2e4d071ba2e68910132a8da5784a6.292</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;CI-&gt;PartnameNew ---&gt;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;657db64230b9d647362bfe0ebb82f7bd1d879400.a0f2e4d071ba2e68910132a8da5784a6</div></div><!-- fragment --><p> so in order to get the original file name(CI-&gt;PartnameNew): we need get the upload archive name first, then get rid of the postfix.</p>
<p>For example: for test.gz, get rid of .gz, get the original file name 'test', replace sha1.md5.size file name with 'test'.</p>
<p>If the file processed is a sub-archive, in the other words, it is part of other archive, or not using repository, need get rid of the postfix two time, for example:</p><ol type="1">
<li>for test.tar.gz, it is in test.rpm, when test.tar.gz is unpacked, the name of unpacked file should be test.tar under test.tar.gz.dir, but it is test.tar.gz.dir, so do as below: test.tar.gz.dir&ndash;&gt;test.tar.gz&ndash;&gt;test.tar,</li>
<li>for metahandle.tab.bz2, it is one top archive, when metahandle.tab.bz2 is unpacked, the name of unpacked file should be metahandle.tab, so do as below: metahandle.tab.bz2.dir&ndash;&gt;metahandle.tab.bz2&ndash;&gt;metahandle.tab,</li>
</ol>

<p>Definition at line <a class="el" href="../../dc/d51/traverse_8c_source.html#l00107">107</a> of file <a class="el" href="../../dc/d51/traverse_8c_source.html">traverse.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4da0dd2880528cc3d606115c7a0b6a6f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TraverseStart </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>Label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>NewDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>Recurse</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find all files (assuming a directory) and process (unpack) all of them. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Filename</td><td>Pathname of file to process </td></tr>
    <tr><td class="paramname">Label</td><td>String displayed by debug messages </td></tr>
    <tr><td class="paramname">NewDir</td><td>Optional, specifies an alternate directory to extract to. </td></tr>
    <tr><td class="paramname">Recurse</td><td>&gt;0 to recurse </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../dc/d51/traverse_8c_source.html#l00034">34</a> of file <a class="el" href="../../dc/d51/traverse_8c_source.html">traverse.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="../../dir_5f27d04085cf5632b5250e7d720a5094.html">ununpack</a></li><li class="navelem"><a class="el" href="../../dir_0ac331944ea22858c41867ea753814de.html">agent</a></li><li class="navelem"><a class="el" href="../../dc/d51/traverse_8c.html">traverse.c</a></li>
    <li class="footer">Generated on Mon Jun 29 2020 12:03:46 for FOSSology by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
